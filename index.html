<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Safari → SSO → Redirect</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body { font:14px/1.5 -apple-system, system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin:24px }
  pre  { background:#f7f7f9; border:1px solid #e5e5ea; padding:12px; border-radius:8px; overflow:auto; }
  .hint{ color:#666 }
</style>
</head>
<body>
<h1>Redirect test (Safari → apps.pingone.com → Google)</h1>
<p class="hint">This page immediately navigates to the SSO URL. Your Redirect-type SSO extension should intercept and return a 3xx to Google. A fallback timer will send you to Google if nothing happens.</p>

<pre id="log">(waiting)</pre>

<script>
/*** === CONFIG — EDIT THESE === ***/
const SSO_BASE   = "https://apps.pingone.com/pingid/desktop"; // must match your Redirect profile's URLs prefix
const SSO_PATH   = "/register";                                    // any path under SSO_BASE you use to trigger the extension
const TARGET_URL = "https://siddhantmishra1305.github.io/test/";  // where you ultimately want to land
const SELF_URL   = location.origin + location.pathname;        // this page (for debugging round-trips)
/*** ============================ ***/

const logEl = document.getElementById('log');
const log = (...a) => { logEl.textContent = a.map(String).join(" ") + "\n" + logEl.textContent; };

function randState() {
  const a = new Uint8Array(16); crypto.getRandomValues(a);
  return Array.from(a, x => x.toString(16).padStart(2, "0")).join("");
}

// If we returned here with params, show them (don’t re-trigger)
(function showCallbackIfAny(){
  if (!location.search) return;
  const qp = new URLSearchParams(location.search);
  const state = qp.get("state");
  const token = qp.get("token") || qp.get("jwt") || qp.get("code");
  log("Returned to self with params:");
  log("state:", state || "(none)");
  log("token:", token ? token.slice(0, 90) + (token.length > 90 ? "…" : "") : "(none)");
  // Clear query from bar so refresh doesn’t keep state
  const u = new URL(location.href); u.search = ""; history.replaceState(null, "", u);
})();

window.addEventListener("DOMContentLoaded", () => {
  // Build an SSO URL that asks extension to send us straight to TARGET_URL.
  const state = randState();
  sessionStorage.setItem("sso_state", state);

  const sso = new URL(SSO_BASE + SSO_PATH);
  // Your extension can read these; it should 302/303 to TARGET_URL
  sso.searchParams.set("redirect_uri", TARGET_URL);
  sso.searchParams.set("state", state);

  log("Navigating to:", sso.toString());
  // Top-level navigation (required for Redirect-type SSO in Safari)
  window.top.location.assign(sso.toString());

  // Fallback: if nothing intercepts within N seconds, go to Google anyway
  setTimeout(() => {
    log("Fallback: sending to:", TARGET_URL);
    window.top.location.replace(TARGET_URL);
  }, 2500);
});
</script>
</body>
</html>
